const e="undefined"!=typeof navigator&&navigator.userAgent.toLowerCase().indexOf("firefox")>0;function t(e,t,n,o){e.addEventListener?e.addEventListener(t,n,o):e.attachEvent&&e.attachEvent("on".concat(t),n)}function n(e,t,n,o){e.removeEventListener?e.removeEventListener(t,n,o):e.deachEvent&&e.deachEvent("on".concat(t),n)}function o(e,t){const n=t.slice(0,t.length-1);for(let o=0;o<n.length;o++)n[o]=e[n[o].toLowerCase()];return n}function r(e){"string"!=typeof e&&(e="");const t=(e=e.replace(/\s/g,"")).split(",");let n=t.lastIndexOf("");for(;n>=0;)t[n-1]+=",",t.splice(n,1),n=t.lastIndexOf("");return t}const i={backspace:8,"⌫":8,tab:9,clear:12,enter:13,"↩":13,return:13,esc:27,escape:27,space:32,left:37,up:38,right:39,down:40,del:46,delete:46,ins:45,insert:45,home:36,end:35,pageup:33,pagedown:34,capslock:20,num_0:96,num_1:97,num_2:98,num_3:99,num_4:100,num_5:101,num_6:102,num_7:103,num_8:104,num_9:105,num_multiply:106,num_add:107,num_enter:108,num_subtract:109,num_decimal:110,num_divide:111,"⇪":20,",":188,".":190,"/":191,"`":192,"-":e?173:189,"=":e?61:187,";":e?59:186,"'":222,"[":219,"]":221,"\\":220},s={"⇧":16,shift:16,"⌥":18,alt:18,option:18,"⌃":17,ctrl:17,control:17,"⌘":91,cmd:91,command:91},c={16:"shiftKey",18:"altKey",17:"ctrlKey",91:"metaKey",shiftKey:16,ctrlKey:17,altKey:18,metaKey:91},l={16:!1,18:!1,17:!1,91:!1},f={};for(let b=1;b<20;b++)i["f".concat(b)]=111+b;let a=[],p=null,u="all";const d=new Map,y=e=>i[e.toLowerCase()]||s[e.toLowerCase()]||e.toUpperCase().charCodeAt(0);function h(e){u=e||"all"}function m(){return u||"all"}function k(e){if(void 0===e)Object.keys(f).forEach((e=>{Array.isArray(f[e])&&f[e].forEach((e=>g(e))),delete f[e]})),E(null);else if(Array.isArray(e))e.forEach((e=>{e.key&&g(e)}));else if("object"==typeof e)e.key&&g(e);else if("string"==typeof e){for(var t=arguments.length,n=new Array(t>1?t-1:0),o=1;o<t;o++)n[o-1]=arguments[o];let[r,i]=n;"function"==typeof r&&(i=r,r=""),g({key:e,scope:r,method:i,splitKey:"+"})}}const g=e=>{let{key:t,scope:n,method:i,splitKey:c="+"}=e;r(t).forEach((e=>{const t=e.split(c),r=t.length,l=t[r-1],a="*"===l?"*":y(l);if(!f[a])return;n||(n=m());const p=r>1?o(s,t):[],u=[];f[a]=f[a].filter((e=>{const t=(!i||e.method===i)&&e.scope===n&&function(e,t){const n=e.length>=t.length?e:t,o=e.length>=t.length?t:e;let r=!0;for(let i=0;i<n.length;i++)-1===o.indexOf(n[i])&&(r=!1);return r}(e.mods,p);return t&&u.push(e.element),!t})),u.forEach((e=>E(e)))}))};function w(e,t,n,o){if(t.element!==o)return;let r;if(t.scope===n||"all"===t.scope){r=t.mods.length>0;for(const e in l)Object.prototype.hasOwnProperty.call(l,e)&&(!l[e]&&t.mods.indexOf(+e)>-1||l[e]&&-1===t.mods.indexOf(+e))&&(r=!1);(0!==t.mods.length||l[16]||l[18]||l[17]||l[91])&&!r&&"*"!==t.shortcut||(t.keys=[],t.keys=t.keys.concat(a),!1===t.method(e,t)&&(e.preventDefault?e.preventDefault():e.returnValue=!1,e.stopPropagation&&e.stopPropagation(),e.cancelBubble&&(e.cancelBubble=!0)))}}function O(e,t){const n=f["*"];let o=e.keyCode||e.which||e.charCode;if(!v.filter.call(this,e))return;if(93!==o&&224!==o||(o=91),-1===a.indexOf(o)&&229!==o&&a.push(o),["ctrlKey","altKey","shiftKey","metaKey"].forEach((t=>{const n=c[t];e[t]&&-1===a.indexOf(n)?a.push(n):!e[t]&&a.indexOf(n)>-1?a.splice(a.indexOf(n),1):"metaKey"===t&&e[t]&&3===a.length&&(e.ctrlKey||e.shiftKey||e.altKey||(a=a.slice(a.indexOf(n))))})),o in l){l[o]=!0;for(const e in s)s[e]===o&&(v[e]=!0);if(!n)return}for(const s in l)Object.prototype.hasOwnProperty.call(l,s)&&(l[s]=e[c[s]]);e.getModifierState&&(!e.altKey||e.ctrlKey)&&e.getModifierState("AltGraph")&&(-1===a.indexOf(17)&&a.push(17),-1===a.indexOf(18)&&a.push(18),l[17]=!0,l[18]=!0);const r=m();if(n)for(let s=0;s<n.length;s++)n[s].scope===r&&("keydown"===e.type&&n[s].keydown||"keyup"===e.type&&n[s].keyup)&&w(e,n[s],r,t);if(!(o in f))return;const i=f[o],p=i.length;for(let s=0;s<p;s++)if(("keydown"===e.type&&i[s].keydown||"keyup"===e.type&&i[s].keyup)&&i[s].key){const n=i[s],{splitKey:o}=n,c=n.key.split(o),l=[];for(let e=0;e<c.length;e++)l.push(y(c[e]));l.sort().join("")===a.sort().join("")&&w(e,n,r,t)}}function v(e,n,i){a=[];const c=r(e);let u=[],h="all",m=document,g=0,w=!1,E=!0,K="+",b=!1,j=!1;for(void 0===i&&"function"==typeof n&&(i=n),"[object Object]"===Object.prototype.toString.call(n)&&(n.scope&&(h=n.scope),n.element&&(m=n.element),n.keyup&&(w=n.keyup),void 0!==n.keydown&&(E=n.keydown),void 0!==n.capture&&(b=n.capture),"string"==typeof n.splitKey&&(K=n.splitKey),!0===n.single&&(j=!0)),"string"==typeof n&&(h=n),j&&k(e,h);g<c.length;g++)u=[],(e=c[g].split(K)).length>1&&(u=o(s,e)),(e="*"===(e=e[e.length-1])?"*":y(e))in f||(f[e]=[]),f[e].push({keyup:w,keydown:E,scope:h,mods:u,shortcut:c[g],method:i,key:c[g],splitKey:K,element:m});if(void 0!==m&&window){if(!d.has(m)){const e=function(){return O(arguments.length>0&&void 0!==arguments[0]?arguments[0]:window.event,m)},n=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:window.event;O(e,m),function(e){let t=e.keyCode||e.which||e.charCode;const n=a.indexOf(t);if(n>=0&&a.splice(n,1),e.key&&"meta"===e.key.toLowerCase()&&a.splice(0,a.length),93!==t&&224!==t||(t=91),t in l){l[t]=!1;for(const e in s)s[e]===t&&(v[e]=!1)}}(e)};d.set(m,{keydownListener:e,keyupListenr:n,capture:b}),t(m,"keydown",e,b),t(m,"keyup",n,b)}if(!p){const e=()=>{a=[]};p={listener:e,capture:b},t(window,"focus",e,b)}}}function E(e){const t=Object.values(f).flat();if(t.findIndex((t=>{let{element:n}=t;return n===e}))<0){const{keydownListener:t,keyupListenr:o,capture:r}=d.get(e)||{};t&&o&&(n(e,"keyup",o,r),n(e,"keydown",t,r),d.delete(e))}if(t.length<=0||d.size<=0){if(Object.keys(d).forEach((e=>{const{keydownListener:t,keyupListenr:o,capture:r}=d.get(e)||{};t&&o&&(n(e,"keyup",o,r),n(e,"keydown",t,r),d.delete(e))})),d.clear(),Object.keys(f).forEach((e=>delete f[e])),p){const{listener:e,capture:t}=p;n(window,"focus",e,t),p=null}}}const K={getPressedKeyString:function(){return a.map((e=>{return t=e,Object.keys(i).find((e=>i[e]===t))||(e=>Object.keys(s).find((t=>s[t]===e)))(e)||String.fromCharCode(e);var t}))},setScope:h,getScope:m,deleteScope:function(e,t){let n,o;e||(e=m());for(const r in f)if(Object.prototype.hasOwnProperty.call(f,r))for(n=f[r],o=0;o<n.length;)if(n[o].scope===e){n.splice(o,1).forEach((e=>{let{element:t}=e;return E(t)}))}else o++;m()===e&&h(t||"all")},getPressedKeyCodes:function(){return a.slice(0)},getAllKeyCodes:function(){const e=[];return Object.keys(f).forEach((t=>{f[t].forEach((t=>{let{key:n,scope:o,mods:r,shortcut:i}=t;e.push({scope:o,shortcut:i,mods:r,keys:n.split("+").map((e=>y(e)))})}))})),e},isPressed:function(e){return"string"==typeof e&&(e=y(e)),-1!==a.indexOf(e)},filter:function(e){const t=e.target||e.srcElement,{tagName:n}=t;let o=!0;return!t.isContentEditable&&("INPUT"!==n&&"TEXTAREA"!==n&&"SELECT"!==n||t.readOnly)||(o=!1),o},trigger:function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"all";Object.keys(f).forEach((n=>{f[n].filter((n=>n.scope===t&&n.shortcut===e)).forEach((e=>{e&&e.method&&e.method()}))}))},unbind:k,keyMap:i,modifier:s,modifierMap:c};for(const b in K)Object.prototype.hasOwnProperty.call(K,b)&&(v[b]=K[b]);if("undefined"!=typeof window){const e=window.hotkeys;v.noConflict=t=>(t&&window.hotkeys===v&&(window.hotkeys=e),v),window.hotkeys=v}export{v as h};
